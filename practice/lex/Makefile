#====================================================
# 1. 変数の定義
#====================================================

# 'flex'の入力ファイル (.l) をすべて取得し、拡張子 (.l) を取り除いたリスト
TARGETS = $(patsubst %.l,%,$(wildcard *.l))

# Flexで生成されるC言語のソースファイル名
C_SOURCE = lex.yy.c

# Flexを呼び出すコマンド
FLEX = flex

# Cコンパイラ
CC = gcc

# Flexライブラリ（通常は-lfl）
FLEX_LIB = -lfl

#====================================================
# 2. メインターゲット (all)
#====================================================

# ターゲットが指定されない場合にデフォルトで実行される
all: $(TARGETS)

#====================================================
# 3. 実行可能ファイル生成ルール (.l -> 実行ファイル)
#====================================================

# 実行可能ファイル名のパターンマッチングルール
# $^ : 依存関係のリスト (例: split_words.l)
# $@ : ターゲット名 (例: split_words)
%: %.l
	# 1. FlexでCソースコードを生成
	$(FLEX) $<
	# 2. Cソースコードをコンパイルして実行ファイルを生成
	$(CC) $(C_SOURCE) -o $@ $(FLEX_LIB)
	# 3. 生成された中間ファイルを削除 (クリーンアップ)
	rm -f $(C_SOURCE)

#====================================================
# 4. クリーンアップターゲット
#====================================================

# 生成された実行可能ファイルと一時ファイルを削除
clean:
	rm -f $(TARGETS) $(C_SOURCE)
	# Flexが生成する可能性のあるその他のファイルも削除
	rm -f *.output

.PHONY: all clean
