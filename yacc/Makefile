#====================================================
# 1. 自動検出設定
#====================================================
# ディレクトリ内のすべての .y ファイルを取得 (define.y define_mul.y)
SRCS = $(wildcard *.y)

# 拡張子 .y を取り除いてターゲット名リストを作成 (define define_mul)
TARGETS = $(SRCS:.y=)

# コンパイラ設定
CC = gcc
LIBS = -lfl -ly

#====================================================
# 2. メインターゲット (all)
#====================================================
# make と打つと、リストアップされた全ターゲットを作成しにいく
all: $(TARGETS)

#====================================================
# 3. ビルド・ルール
#====================================================
# 任意の名前(%)を作るためのルール
# 例: define_mul を作るには define_mul.y と define_mul.l が必要
%: %.y %.l
	# 1. Bison (.y -> .tab.c, .tab.h)
	bison -d $<
	
	# 2. Flex (.l -> lex.yy.c)
	flex $*.l
	
	# 3. Compile
	$(CC) $*.tab.c lex.yy.c -o $@ $(LIBS)
	
	# 4. 中間ファイル削除
	rm -f $*.tab.c $*.tab.h lex.yy.c

#====================================================
# 4. クリーンアップ
#====================================================
clean:
	rm -f $(TARGETS) *.tab.c *.tab.h lex.yy.c

.PHONY: all clean
